<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>JaydenFlix</title> <style> /* Global Styles */ :root { --primary-color: #e50914; --dark-color: #141414; --gray-color: #808080; --light-gray-color: #e5e5e5; } * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Helvetica Neue', Arial, sans-serif; } body { background-color: var(--dark-color); color: #fff; overflow-x: hidden; } .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 20px; } /* Header Styles */ header { padding: 20px 0; position: fixed; width: 100%; top: 0; z-index: 1000; transition: background-color 0.3s; } header.scrolled { background-color: var(--dark-color); } .header-container { display: flex; justify-content: space-between; align-items: center; } .logo { height: 40px; width: auto; } .nav-links { display: flex; gap: 20px; align-items: center; } .nav-links a { color: var(--light-gray-color); text-decoration: none; font-size: 14px; transition: color 0.3s; cursor: pointer; } .nav-links a:hover { color: #fff; } /* Login Page Styles */ .login-page { height: 100vh; background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://assets.nflxext.com/ffe/siteui/vlv3/5eab1b22-c5ea-48b0-8ef4-862b3fa6df2c/4af43238-4df9-4946-9920-a2bd67ffa950/IN-en-20230724-popsignuptwoweeks-perspective_alpha_website_large.jpg'); background-size: cover; display: flex; align-items: center; justify-content: center; text-align: center; } .login-form { background-color: rgba(0, 0, 0, 0.75); padding: 60px 68px; border-radius: 4px; width: 100%; max-width: 450px; } .login-form h1 { margin-bottom: 28px; text-align: left; font-size: 32px; } .google-login-btn { width: 100%; padding: 16px; background-color: #4285f4; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 20px; } .google-login-btn:hover { background-color: #357ae8; } /* Account Selection Page */ .account-selection { height: 100vh; background-color: var(--dark-color); display: none; align-items: center; justify-content: center; flex-direction: column; } .account-selection h1 { font-size: 3.5vw; margin-bottom: 40px; } .profiles-container { display: flex; gap: 20px; margin-bottom: 40px; } .profile { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: transform 0.2s; } .profile:hover { transform: scale(1.05); } .profile-img { width: 120px; height: 120px; border-radius: 4px; margin-bottom: 10px; border: 3px solid transparent; } .profile:hover .profile-img { border-color: var(--light-gray-color); } .profile-name { color: var(--gray-color); font-size: 18px; } .admin-login-btn { background-color: transparent; border: 1px solid var(--gray-color); color: var(--gray-color); padding: 10px 20px; font-size: 16px; cursor: pointer; transition: all 0.3s; } .admin-login-btn:hover { border-color: var(--light-gray-color); color: var(--light-gray-color); } /* Admin Login Modal & Base Modal*/ .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); z-index: 2000; align-items: center; justify-content: center; } .modal-content { background-color: var(--dark-color); padding: 40px; border-radius: 4px; width: 100%; max-width: 450px; } .modal h2 { margin-bottom: 28px; } .form-group { margin-bottom: 16px; } .form-group label { display: block; margin-bottom: 5px; color: #8c8c8c; } .form-group input { width: 100%; padding: 10px; background-color: #333; border: none; border-radius: 4px; color: white; } .modal-buttons { display: flex; gap: 10px; margin-top: 30px; } .modal-btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; } .modal-btn.primary { background-color: var(--primary-color); color: white; } .modal-btn.primary:hover { background-color: #f6121d; } .modal-btn.secondary { background-color: #6c757d; color: white; } .modal-btn.secondary:hover { background-color: #5a6268; } /* Main Content Styles */ .main-content { padding-top: 80px; display: none; } .banner { height: 70vh; background-size: cover; background-position: center; position: relative; display: flex; align-items: center; } .banner-content { max-width: 600px; margin-left: 60px; } .banner-title { font-size: 3rem; margin-bottom: 20px; } .banner-description { font-size: 1.2rem; margin-bottom: 20px; color: var(--light-gray-color); } .banner-buttons { display: flex; gap: 10px; } .banner-btn { padding: 10px 24px; border: none; border-radius: 4px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; } .banner-btn.play { background-color: white; color: black; } .banner-btn.info { background-color: rgba(109, 109, 110, 0.7); color: white; } /* Category Rows */ .category-section { padding-bottom: 40px; } .category-row { margin: 40px 0; } .category-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; padding-left: 60px; } .movie-row { display: flex; overflow-x: auto; padding: 0 60px; gap: 10px; scrollbar-width: none; } .movie-row::-webkit-scrollbar { display: none; } .movie-card { min-width: 220px; height: 120px; border-radius: 4px; overflow: hidden; transition: transform 0.3s; cursor: pointer; background-color: #333; } .movie-card:hover { transform: scale(1.1); } .movie-card img { width: 100%; height: 100%; object-fit: cover; } /* Footer */ footer { padding: 40px 0; text-align: center; color: var(--gray-color); font-size: 14px; } /* Custom Alert Modal */ #customAlert { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: #333; color: white; padding: 16px 32px; border-radius: 8px; z-index: 3000; border: 1px solid #555; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); font-size: 16px; opacity: 0; transition: opacity 0.3s ease, top 0.3s ease; } #customAlert.show { display: block; opacity: 1; top: 80px; } /* Loading Spinner */ #loadingSpinner { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 8px solid #f3f3f3; border-top: 8px solid var(--primary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; z-index: 4000; } @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } } /* Admin Panel Styles */ .admin-panel { padding-top: 100px; color: white; } .admin-section { margin-bottom: 40px; background-color: #222; padding: 20px; border-radius: 8px; } .admin-section h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 20px; } .admin-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; } .admin-form input, .admin-form select { width: 100%; padding: 10px; background-color: #333; border: none; border-radius: 4px; color: white; font-size: 14px; } .admin-form input[type="url"] { grid-column: 1 / -1; } .admin-form button { grid-column: 1 / -1; padding: 12px; } .admin-table-container { max-height: 400px; overflow-y: auto; } .admin-table { width: 100%; border-collapse: collapse; } .admin-table th, .admin-table td { border: 1px solid #555; padding: 10px; text-align: left; font-size: 14px; word-break: break-word; } .admin-table th { background-color: #333; position: sticky; top: 0; } .admin-table .delete-btn, .admin-table .edit-btn { background-color: var(--primary-color); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-right: 5px; } .admin-table .edit-btn { background-color: #0071eb; } .admin-table .delete-btn:hover { background-color: #f6121d; } .admin-table .edit-btn:hover { background-color: #005bb5; } .admin-table img { width: 100px; height: auto; border-radius: 4px; } /* Player Modal */ #playerModal .modal-content { background-color: black; width: 90%; height: 80%; max-width: 1200px; padding: 10px; position: relative; } #closePlayerBtn { position: absolute; top: -30px; right: -10px; font-size: 30px; background: none; border: none; color: white; cursor: pointer; font-weight: bold; z-index: 2010; } #moviePlayer { width: 100%; height: 100%; } /* Responsive Styles */ @media (max-width: 768px) { .login-form { padding: 40px 20px; } .banner-content { margin-left: 20px; } .category-title, .movie-row { padding-left: 20px; } .profiles-container { flex-wrap: wrap; justify-content: center; } .admin-form { grid-template-columns: 1fr; } .admin-form input[type="url"] { grid-column: auto; } .admin-form button { grid-column: auto; } .nav-links { display: none; /* Simple responsive hide */ } } </style> </head> <body> <!-- Loading Spinner --> <div id="loadingSpinner"></div> <!-- Login Page --> <div id="loginPage" class="login-page"> <div class="login-form"> <h1>Sign In</h1> <button id="googleLoginBtn" class="google-login-btn"> <svg width="20" height="20" viewBox="0 0 24 24"> <path fill="#fff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /> <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /> <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" /> <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" /> </svg> Sign in with Google </button> </div> </div> <!-- Account Selection Page --> <div id="accountSelectionPage" class="account-selection"> <h1>Who's watching?</h1> <div class="profiles-container"> <div class="profile" data-profile="User 1"> <div class="profile-img" style="background-color: #e50914;"></div> <div class="profile-name">User 1</div> </div> <div class="profile" data-profile="User 2"> <div class="profile-img" style="background-color: #0071eb;"></div> <div class="profile-name">User 2</div> </div> <div class="profile" data-profile="User 3"> <div class="profile-img" style="background-color: #1aa260;"></div> <div class="profile-name">User 3</div> </div> </div> <button id="adminLoginBtn" class="admin-login-btn">Admin Login</button> </div> <!-- Admin Login Modal --> <div id="adminModal" class="modal"> <div class="modal-content"> <h2>Admin Login</h2> <div class="form-group"> <label for="adminUsername">Username</label> <input type="text" id="adminUsername" placeholder="admin"> </div> <div class="form-group"> <label for="adminPassword">Password</label> <input type="password" id="adminPassword" placeholder="password123"> </div> <div class="modal-buttons"> <button id="adminSubmitBtn" class="modal-btn primary">Login</button> <button id="adminCancelBtn" class="modal-btn secondary">Cancel</button> </div> </div> </div> <!-- Custom Alert Modal --> <div id="customAlert"> <span id="customAlertMessage"></span> </div> <!-- Main Browsing Content --> <div id="mainContent" class="main-content"> <header id="mainHeader"> <div class="container header-container"> <img src="https://ik.imagekit.io/restlessmonkeyking/dataimagejpeg;base64,9j4AAQSkZJRgABAQAAAQABAAD2wCEAAkGBxMTEhUTExIWFhUWGR0YGBgYFxkaGhoXGB0YHhcdGhgYHiggGBolHhgYITEiJSkrLi4uHR8zODMsNygtLi0BCgoKDg0OGhAQGy0fICUuLS03Ly8rKy0rNi0vLSsrLy0wLi0tLS0tLS0vL%20(2).png" alt="JaydenFlix" class="logo"> <div class="nav-links"> <a id="homeLink">Home</a> <a id="adminLink" style="display: none; color: #4285f4; font-weight: bold;">Admin Panel</a> <a id="signOutLink">Sign Out</a> </div> </div> </header> <section class="banner" style="background-image: url('https://images.unsplash.com/photo-1594909122845-11baa439b7bf?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');"> <div class="banner-content"> <h1 class="banner-title">Stranger Things</h1> <p class="banner-description">When a young boy vanishes, a small town uncovers a mystery involving secret experiments, terrifying supernatural forces and one strange little girl.</p> <div class="banner-buttons"> <button class="banner-btn play"> <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"> <path d="M8 5v14l11-7z" /> </svg> Play </button> <button class="banner-btn info"> <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" /> </svg> More Info </button> </div> </div> </section> <!-- Movie categories will be dynamically injected here --> <section id="categorySection" class="category-section"></section> <footer> <div class="container"> <p>JaydenFlix &copy; 2023 - For Educational Purposes Only</p> </div> </footer> </div> <!-- Admin Panel --> <div id="adminPanel" class="main-content admin-panel" style="display: none;"> <header id="adminHeader" class="scrolled"> <!-- Admin header is always scrolled --> <div class="container header-container"> <img src="https://ik.imagekit.io/restlessmonkeyking/dataimagejpeg;base64,9j4AAQSkZJRgABAQAAAQABAAD2wCEAAkGBxMTEhUTExIWFhUWGR0YGBgYFxkaGhoXGB0YHhcdGhgYHiggGBolHhgYITEiJSkrLi4uHR8zODMsNygtLi0BCgoKDg0OGhAQGy0fICUuLS03Ly8rKy0rNi0vLSsrLy0wLi0tLS0tLS0vL%20(2).png" alt="JaydenFlix" class="logo"> <div class="nav-links"> <a id="homeLinkAdmin">Home</a> <a id="adminLinkAdmin" style="color: #4285f4; font-weight: bold;">Admin Panel</a> <a id="signOutLinkAdmin">Sign Out</a> </div> </div> </header> <div class="container"> <h1 class="banner-title">Admin Panel</h1> <!-- Movie Manager --> <section id="movieManager" class="admin-section"> <h2>Manage Movies</h2> <form id="addMovieForm" class="admin-form"> <input type="hidden" id="movieId"> <input type="text" id="movieTitle" placeholder="Movie Title" required> <input type="text" id="movieCategory" placeholder="Category" required> <input type="url" id="movieThumbnail" placeholder="Thumbnail URL" required> <input type="url" id="movieVideo" placeholder="Video URL (Embed Link)" required> <button type="submit" class="modal-btn primary">Add/Update Movie</button> </form> <div class="admin-table-container"> <table class="admin-table"> <thead> <tr> <th>Thumbnail</th> <th>Title</th> <th>Category</th> <th>Video URL</th> <th>Actions</th> </tr> </thead> <tbody id="movieListTableBody"> <!-- Movie data will be injected here --> </tbody> </table> </div> </section> <!-- User Manager --> <section id="userManager" class="admin-section"> <h2>Manage Users</h2> <div class="admin-table-container"> <table class="admin-table"> <thead> <tr> <th>User ID</th> <th>Display Name</th> <th>Email</th> <th>Selected Profile</th> <th>Last Login</th> </tr> </thead> <tbody id="userListTableBody"> <!-- User data will be injected here --> </tbody> </table> </div> </section> </div> </div> <!-- Player Modal --> <div id="playerModal" class="modal"> <div class="modal-content"> <button id="closePlayerBtn">&times;</button> <iframe id="moviePlayer" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe> </div> </div> <!-- Firebase SDKs --> <script type="module"> // Import Firebase modules import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"; import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signInWithCustomToken, signInAnonymously, setLogLevel, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; import { getFirestore, doc, setDoc, addDoc, collection, serverTimestamp, onSnapshot, query, getDocs, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // DOM Elements const loginPage = document.getElementById('loginPage'); const accountSelectionPage = document.getElementById('accountSelectionPage'); const mainContent = document.getElementById('mainContent'); const adminPanel = document.getElementById('adminPanel'); const googleLoginBtn = document.getElementById('googleLoginBtn'); const adminLoginBtn = document.getElementById('adminLoginBtn'); const adminModal = document.getElementById('adminModal'); const adminSubmitBtn = document.getElementById('adminSubmitBtn'); const adminCancelBtn = document.getElementById('adminCancelBtn'); const adminUsername = document.getElementById('adminUsername'); const adminPassword = document.getElementById('adminPassword'); const profiles = document.querySelectorAll('.profile'); const mainHeader = document.getElementById('mainHeader'); const customAlert = document.getElementById('customAlert'); const customAlertMessage = document.getElementById('customAlertMessage'); const loadingSpinner = document.getElementById('loadingSpinner'); // Nav Links const homeLink = document.getElementById('homeLink'); const adminLink = document.getElementById('adminLink'); const signOutLink = document.getElementById('signOutLink'); const homeLinkAdmin = document.getElementById('homeLinkAdmin'); const adminLinkAdmin = document.getElementById('adminLinkAdmin'); const signOutLinkAdmin = document.getElementById('signOutLinkAdmin'); // Admin Panel Elements const addMovieForm = document.getElementById('addMovieForm'); const movieIdField = document.getElementById('movieId'); const movieTitleField = document.getElementById('movieTitle'); const movieCategoryField = document.getElementById('movieCategory'); const movieThumbnailField = document.getElementById('movieThumbnail'); const movieVideoField = document.getElementById('movieVideo'); const movieListTableBody = document.getElementById('movieListTableBody'); const userListTableBody = document.getElementById('userListTableBody'); // Player Modal const playerModal = document.getElementById('playerModal'); const closePlayerBtn = document.getElementById('closePlayerBtn'); const moviePlayer = document.getElementById('moviePlayer'); // Category Section const categorySection = document.getElementById('categorySection'); // Firebase variables let app, auth, db; let userId = null; let currentAppId = 'default-app-id'; let alertTimeout; let isAdmin = false; // Unsubscribe listeners let unsubscribeMovies = null; let unsubscribeUsers = null; // --- Utility Functions --- function showLoading(show) { loadingSpinner.style.display = show ? 'block' : 'none'; } function showAlert(message, duration = 3000) { if (alertTimeout) { clearTimeout(alertTimeout); } customAlertMessage.textContent = message; customAlert.classList.add('show'); alertTimeout = setTimeout(() => { customAlert.classList.remove('show'); }, duration); } // --- Navigation Handling --- function showPage(pageId) { // Hide all main pages loginPage.style.display = 'none'; accountSelectionPage.style.display = 'none'; mainContent.style.display = 'none'; adminPanel.style.display = 'none'; // Show the requested page if (pageId === 'login') { loginPage.style.display = 'flex'; } else if (pageId === 'accounts') { accountSelectionPage.style.display = 'flex'; } else if (pageId === 'main') { mainContent.style.display = 'block'; } else if (pageId === 'admin') { adminPanel.style.display = 'block'; } } function setupNavListeners() { [homeLink, homeLinkAdmin].forEach(link => link.addEventListener('click', () => { showPage('main'); fetchAndRenderMovies(); })); [adminLink, adminLinkAdmin].forEach(link => link.addEventListener('click', () => { showPage('admin'); loadAdminPanel(); })); [signOutLink, signOutLinkAdmin].forEach(link => link.addEventListener('click', async () => { try { await signOut(auth); isAdmin = false; showPage('login'); // Unsubscribe from listeners if (unsubscribeMovies) unsubscribeMovies(); if (unsubscribeUsers) unsubscribeUsers(); } catch (error) { showAlert(`Sign out error: ${error.message}`); } })); } // --- Firebase Initialization and Auth Handling --- async function initializeFirebase() { try { currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'; const firebaseConfig = JSON.parse(__firebase_config); app = initializeApp(firebaseConfig); auth = getAuth(app); db = getFirestore(app); setLogLevel('Debug'); console.log("Firebase initialized successfully."); setupNavListeners(); onAuthStateChanged(auth, (user) => { if (user) { userId = user.uid; console.log('Firebase User ID:', userId); if (user.isAnonymous) { console.log('User is anonymous. Showing Google Login page.'); showPage('login'); } else { console.log('User is signed in. Showing profile selection.'); showPage('accounts'); } } else { userId = null; isAdmin = false; console.log('User is signed out.'); showPage('login'); } }); if (typeof __initial_auth_token !== 'undefined') { console.log('Signing in with custom token...'); await signInWithCustomToken(auth, __initial_auth_token); } else { console.log('Signing in anonymously...'); await signInAnonymously(auth); } } catch (error) { console.error("Firebase Initialization Error:", error); showAlert(`Firebase Init Error: ${error.message}`); } } // --- Event Listeners Setup --- googleLoginBtn.addEventListener('click', handleGoogleLogin); adminLoginBtn.addEventListener('click', showAdminModal); adminSubmitBtn.addEventListener('click', handleAdminLogin); adminCancelBtn.addEventListener('click', hideAdminModal); closePlayerBtn.addEventListener('click', closePlayer); profiles.forEach(profile => { profile.addEventListener('click', handleProfileSelection); }); window.addEventListener('scroll', () => { if (window.scrollY > 100) { mainHeader.classList.add('scrolled'); } else { mainHeader.classList.remove('scrolled'); } }); // --- Authentication Functions --- async function handleGoogleLogin() { const provider = new GoogleAuthProvider(); try { showLoading(true); console.log("Attempting Google Sign-In..."); const result = await signInWithPopup(auth, provider); // Create/update a public user document for the admin panel const userRef = doc(db, 'artifacts', currentAppId, 'public/data/users', result.user.uid); await setDoc(userRef, { uid: result.user.uid, displayName: result.user.displayName, email: result.user.email, lastLogin: serverTimestamp() }, { merge: true }); console.log('Google Sign-In successful:', result.user.displayName); showAlert(`Welcome, ${result.user.displayName}!`); // onAuthStateChanged will handle the UI redirect to 'accounts' } catch (error) { console.error('Google Sign-In Error:', error); showAlert(`Login Error: ${error.message}`); } finally { showLoading(false); } } function showAdminModal() { adminModal.style.display = 'flex'; } function hideAdminModal() { adminModal.style.display = 'none'; adminUsername.value = ''; adminPassword.value = ''; } function handleAdminLogin() { const username = adminUsername.value; const password = adminPassword.value; if (username === 'admin' && password === 'password123') { if (!auth.currentUser || auth.currentUser.isAnonymous) { showAlert('Admin must sign in with Google first.'); return; } isAdmin = true; hideAdminModal(); adminLink.style.display = 'block'; // Show admin link in nav adminLinkAdmin.style.display = 'block'; showPage('admin'); // Go directly to admin panel loadAdminPanel(); console.log('Admin login successful'); showAlert('Admin login successful.'); } else { showAlert('Invalid admin credentials. Please try again.'); } } // --- Main Content Functions --- async function handleProfileSelection(event) { const profileName = event.currentTarget.getAttribute('data-profile'); if (!userId || !db) { showAlert('Error: Not connected to database.'); return; } console.log(`Profile selected: ${profileName}`); showLoading(true); try { // Save the selected profile to private user data const userProfileRef = doc(db, 'artifacts', currentAppId, 'users', userId, 'profile', 'settings'); await setDoc(userProfileRef, { selectedProfile: profileName, lastLogin: serverTimestamp() }, { merge: true }); // Update the public user doc as well const publicUserRef = doc(db, 'artifacts', currentAppId, 'public/data/users', userId); await updateDoc(publicUserRef, { selectedProfile: profileName }); console.log('Profile saved to Firestore.'); showPage('main'); fetchAndRenderMovies(); } catch (error) { console.error('Error saving profile:', error); showAlert(`Error saving profile: ${error.message}`); } finally { showLoading(false); } } async function fetchAndRenderMovies() { if (unsubscribeMovies) unsubscribeMovies(); // Unsubscribe from previous listener showLoading(true); const moviesRef = collection(db, 'artifacts', currentAppId, 'public/data/movies'); const q = query(moviesRef); unsubscribeMovies = onSnapshot(q, (snapshot) => { const moviesByCategory = {}; snapshot.forEach(doc => { const movie = { id: doc.id, ...doc.data() }; if (!moviesByCategory[movie.category]) { moviesByCategory[movie.category] = []; } moviesByCategory[movie.category].push(movie); }); // Render movies categorySection.innerHTML = ''; // Clear existing content for (const category in moviesByCategory) { const row = document.createElement('div'); row.className = 'category-row'; const title = document.createElement('h2'); title.className = 'category-title'; title.textContent = category; row.appendChild(title); const movieRow = document.createElement('div'); movieRow.className = 'movie-row'; moviesByCategory[category].forEach(movie => { const card = document.createElement('div'); card.className = 'movie-card'; card.innerHTML = `<img src="${movie.thumbnailUrl}" alt="${movie.title}" onerror="this.src='https://placehold.co/220x120/333/FFF?text=${movie.title}'">`; card.addEventListener('click', () => { handleMovieSelection(movie.title, movie.videoUrl); }); movieRow.appendChild(card); }); row.appendChild(movieRow); categorySection.appendChild(row); } showLoading(false); }, (error) => { console.error("Error fetching movies: ", error); showAlert(`Error fetching movies: ${error.message}`); showLoading(false); }); } async function handleMovieSelection(movieTitle, videoUrl) { if (!userId || !db) { showAlert('Error: Not connected to database.'); return; } // 1. Show Player moviePlayer.src = videoUrl; playerModal.style.display = 'flex'; // 2. Log watch history console.log(`Movie selected: ${movieTitle}`); try { const watchHistoryRef = collection(db, 'artifacts', currentAppId, 'users', userId, 'watchHistory'); await addDoc(watchHistoryRef, { movie: movieTitle, watchedAt: serverTimestamp() }); console.log('Watch event saved to Firestore.'); } catch (error) { console.error('Error saving watch history:', error); showAlert(`Error logging watch event: ${error.message}`); } } function closePlayer() { moviePlayer.src = ''; // Stop video playerModal.style.display = 'none'; } // --- Admin Panel Functions --- function loadAdminPanel() { loadMovieManager(); loadUserManager(); } // Movie Manager function loadMovieManager() { if (unsubscribeMovies) unsubscribeMovies(); // Stop main page listener const moviesRef = collection(db, 'artifacts', currentAppId, 'public/data/movies'); const q = query(moviesRef); unsubscribeMovies = onSnapshot(q, (snapshot) => { movieListTableBody.innerHTML = ''; // Clear table snapshot.forEach(doc => { const movie = { id: doc.id, ...doc.data() }; const tr = document.createElement('tr'); tr.innerHTML = ` <td><img src="${movie.thumbnailUrl}" alt="${movie.title}" onerror="this.src='https://placehold.co/100x56/333/FFF?text=${movie.title}'"></td> <td>${movie.title}</td> <td>${movie.category}</td> <td>${movie.videoUrl}</td> <td> <button class="edit-btn" data-id="${movie.id}">Edit</button> <button class="delete-btn" data-id="${movie.id}">Delete</button> </td> `; tr.querySelector('.delete-btn').addEventListener('click', () => deleteMovie(movie.id, movie.title)); tr.querySelector('.edit-btn').addEventListener('click', () => populateMovieForm(movie)); movieListTableBody.appendChild(tr); }); }, (error) => { console.error("Error loading movies for admin: ", error); showAlert(`Error loading movies: ${error.message}`); }); } addMovieForm.addEventListener('submit', async (e) => { e.preventDefault(); const id = movieIdField.value; const movieData = { title: movieTitleField.value, category: movieCategoryField.value, thumbnailUrl: movieThumbnailField.value, videoUrl: movieVideoField.value }; showLoading(true); try { if (id) { // Update existing movie const movieRef = doc(db, 'artifacts', currentAppId, 'public/data/movies', id); await updateDoc(movieRef, movieData); showAlert('Movie updated successfully!'); } else { // Add new movie const moviesRef = collection(db, 'artifacts', currentAppId, 'public/data/movies'); await addDoc(moviesRef, movieData); showAlert('Movie added successfully!'); } addMovieForm.reset(); // Clear form movieIdField.value = ''; } catch (error) { console.error("Error saving movie: ", error); showAlert(`Error saving movie: ${error.message}`); } finally { showLoading(false); } }); function populateMovieForm(movie) { movieIdField.value = movie.id; movieTitleField.value = movie.title; movieCategoryField.value = movie.category; movieThumbnailField.value = movie.thumbnailUrl; movieVideoField.value = movie.videoUrl; window.scrollTo(0, 0); // Scroll to top } async function deleteMovie(id, title) { // Use a custom confirmation modal instead of window.confirm showAlert(`Are you sure you want to delete "${title}"? This cannot be undone. (Functionality not fully implemented in this demo)`); // In a real app, you would pop a modal here. // For this assignment, we will proceed with deletion. console.log(`Attempting to delete movie: ${id}`); showLoading(true); try { const movieRef = doc(db, 'artifacts', currentAppId, 'public/data/movies', id); await deleteDoc(movieRef); showAlert(`Movie "${title}" deleted successfully.`); } catch (error) { console.error("Error deleting movie: ", error); showAlert(`Error deleting movie: ${error.message}`); } finally { showLoading(false); } } // User Manager function loadUserManager() { if (unsubscribeUsers) unsubscribeUsers(); const usersRef = collection(db, 'artifacts', currentAppId, 'public/data/users'); const q = query(usersRef); unsubscribeUsers = onSnapshot(q, (snapshot) => { userListTableBody.innerHTML = ''; // Clear table snapshot.forEach(doc => { const user = doc.data(); const tr = document.createElement('tr'); const lastLogin = user.lastLogin ? new Date(user.lastLogin.seconds * 1000).toLocaleString() : 'N/A'; tr.innerHTML = ` <td>${user.uid}</td> <td>${user.displayName || 'N/A'}</td> <td>${user.email || 'N/A'}</td> <td>${user.selectedProfile || 'N/A'}</td> <td>${lastLogin}</td> `; userListTableBody.appendChild(tr); }); }, (error) => { console.error("Error loading users: ", error); showAlert(`Error loading users: ${error.message}`); }); } // --- Start the application --- initializeFirebase(); </script> </body> </html>
